{% assign rating_value = 5 %}
{% assign rating_count = 1 %}
{% if product.metafields.reviews.rating %}
  {% assign rating_value = product.metafields.reviews.rating.value | default: 5 %}
{% endif %}
{% if product.metafields.reviews.rating_count %}
  {% assign rating_count = product.metafields.reviews.rating_count.value | default: 1 %}
{% endif %}
{% assign first_variant = product.selected_or_first_available_variant %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.title | escape }}",
  "description": "{{ product.description | strip_html | truncate: 160 | escape }}",
  "image": [{% for image in product.images %}"{{ image | image_url: width: 1200 }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
  "sku": "{{ product.sku }}",
  "brand": {
    "@type": "Organization",
    "name": "{{ shop.name | escape }}"
  },
  "offers": {
    "@type": "Offer",
    "price": "{{ first_variant.price | divided_by: 100.0 }}",
    "priceCurrency": "{{ shop.currency }}",
    "availability": "https://schema.org/{% if first_variant.available %}InStock{% else %}OutOfStock{% endif %}",
    "url": "{{ product.url }}"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ rating_value }}",
    "reviewCount": "{{ rating_count }}"
  }
}
</script>
